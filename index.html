<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <title>Generador de Progressió</title>
</head>

<body>
    <h1>Generador de Progressió d'Acords</h1>

    <!-- Desplegable per seleccionar la durada -->
    <label for="durada">Selecciona la durada de la progressió:</label>
    <select id="durada" name="durada">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
    </select>

    <!-- Botó per generar la progressió -->
    <button id="generar">Generar Progressió</button>

    <!-- Espai per mostrar la progressió generada -->
    <div id="resultat"></div>

    <py-script>
        import random

        # Acords disponibles
        acords = {0: "C", 1: "Db", 2: "D", 3: "Eb", 4: "E", 5: "F", 6: "F#", 7: "G", 8: "Ab", 9: "A", 10: "Bb", 11: "B"}

        # Llegir dades des del fitxer (simulat)
        dades = ['0', '2m', '4', '5', '7m', '9']

        # Funció per generar la progressió
        def generar_progressio(durada, dades, to):
            progressió = []
            progressió_traduïda = []
            caràcters = 0
            while caràcters < durada:
                acord_aleatori = random.choice(dades)
                acords_separats = acord_aleatori.split()
                if caràcters + len(acords_separats) <= durada:
                    progressió.extend(list(acords_separats))
                    caràcters += len(acords_separats)
            for i in progressió:
                if 'm' in i:
                    nota = (int(i[:-1]) + to) % 12
                    nota_traduïda = acords[nota]
                    progressió_traduïda.append(nota_traduïda + 'm')
                else:
                    i = int(i)
                    nota_traduïda = acords[(i + to) % 12]
                    progressió_traduïda.append(nota_traduïda)
            return progressió_traduïda

        # Funció per mostrar la progressió generada
        def mostrar_progressio():
            durada = int(Element("durada").value)
            resultat = generar_progressio(durada, dades, 0)  # Ajustar el to si cal
            Element("resultat").write(f"Progressió: {', '.join(resultat)}")

        # Enllaçar el botó amb la funció
        Element("generar").element.onclick = mostrar_progressio
    </py-script>
</body>

</html>
